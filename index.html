<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TaskPays - Complete Offers to Earn Points</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 100%;
            margin: 0;
            padding: 0;
            background-color: #f5f7fa;
        }
        
        header {
            text-align: center;
            padding: 15px 0;
            margin-bottom: 20px;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .logo {
            font-size: 2rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .logo span {
            color: #3498db;
        }
        
        .container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            padding: 20px;
            margin: 20px auto;
            max-width: 1200px;
        }
        
        .warning {
            background: #fff3e0;
            border-left: 4px solid #ffa000;
            padding: 12px;
            margin-bottom: 20px;
            border-radius: 0 8px 8px 0;
            font-size: 0.9rem;
        }
        
        #balance-section {
            background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        #balance-amount {
            font-size: 2.2rem;
            font-weight: 700;
            margin: 8px 0;
        }
        
        .task-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .task-container {
            background: white;
            border: 1px solid #e1e5eb;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s ease;
        }
        
        .task-container:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: translateY(-3px);
        }
        
        .task-link {
            display: block;
            padding: 12px;
            background: #f0f7ff;
            color: #0066cc;
            text-decoration: none;
            border-radius: 6px;
            font-weight: 600;
            margin-bottom: 8px;
            transition: all 0.3s ease;
            position: relative;
            font-size: 0.95rem;
        }
        
        .task-link:hover {
            background: #d0e7ff;
        }
        
        .task-link.clicked {
            background: #e8f5e9;
            color: #2E7D32;
        }
        
        .task-link.clicked::after {
            content: "✓";
            position: absolute;
            right: 12px;
            color: #2E7D32;
            font-weight: bold;
        }
        
        .task-instruction {
            font-size: 0.75rem;
            color: #666;
            margin-top: 6px;
            padding-left: 5px;
            font-style: italic;
        }
        
        .timer {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(0,0,0,0.1);
            border-top-color: #4CAF50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 6px;
            vertical-align: middle;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        #status {
            text-align: center;
            font-size: 1rem;
            margin: 20px 0;
            font-weight: 600;
        }
        
        .action-buttons {
            display: flex;
            justify-content: center;
            margin: 25px 0;
        }
        
        #withdraw-btn {
            padding: 15px 30px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        #withdraw-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0,0,0,0.15);
        }
        
        #withdraw-btn.active {
            background: #e67e22;
        }
        
        #withdraw-btn.active:hover {
            background: #d35400;
        }
        
        #withdraw-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        #approval-message {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.95);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 30px;
        }
        
        .approval-content {
            max-width: 600px;
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid #e1e5eb;
        }
        
        .approval-icon {
            font-size: 80px;
            color: #4CAF50;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .payment-proof {
            margin: 30px 0;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .proof-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .proof-item {
            padding: 15px;
            background: #f9f9f9;
            border-radius: 6px;
            border-left: 3px solid #4CAF50;
        }
        
        .proof-header {
            font-weight: 600;
            color: #2E7D32;
            margin-bottom: 8px;
        }
        
        .proof-comment {
            font-size: 0.9rem;
            color: #555;
            padding: 8px;
            background: #fff;
            border-radius: 4px;
            margin-top: 8px;
            border: 1px solid #eee;
            font-style: italic;
        }
        
        .proof-user {
            font-weight: 600;
            color: #3498db;
        }
        
        .proof-country {
            display: inline-block;
            padding: 2px 6px;
            background: #e3f2fd;
            border-radius: 12px;
            font-size: 0.7rem;
            margin-left: 6px;
            color: #1a73e8;
        }
        
        .proof-time {
            color: #666;
            font-size: 0.75rem;
            margin-top: 5px;
        }
        
        .completion-check {
            display: none;
            margin-top: 12px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 6px;
            text-align: center;
            border: 1px dashed #ddd;
            font-size: 0.85rem;
        }
        
        .confirmation-btn {
            padding: 8px 15px;
            background: #2ecc71;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 8px;
            transition: all 0.3s ease;
            font-size: 0.85rem;
        }
        
        .confirmation-btn:hover {
            background: #27ae60;
        }
        
        #access-denied {
            display: none;
            text-align: center;
            padding: 30px;
            background: #fff3f3;
            border-radius: 10px;
            border-left: 5px solid #ff5252;
            margin: 20px auto;
            max-width: 600px;
        }
        
        #access-denied h2 {
            color: #ff5252;
        }
        
        .shield-icon {
            font-size: 50px;
            color: #ff5252;
            margin-bottom: 20px;
        }

        .points-message {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: #fff8e1;
            border-radius: 8px;
            border-left: 4px solid #ffc107;
            font-weight: 600;
            color: #5d4037;
        }

        /* Mobile-specific adjustments */
        @media (max-width: 480px) {
            .logo {
                font-size: 1.8rem;
            }
            
            .task-grid {
                grid-template-columns: 1fr;
            }
            
            #balance-amount {
                font-size: 1.8rem;
            }
            
            .approval-content {
                padding: 20px;
                margin: 20px;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Access Denied Message -->
    <div id="access-denied">
        <div class="shield-icon">
            <i class="fas fa-shield-alt"></i>
        </div>
        <h2>Access Restricted</h2>
        <p id="denial-reason">Our system detected ineligible activity</p>
        <p><strong>Only approved users may participate</strong></p>
    </div>

    <!-- Main Website Content (Hidden Initially) -->
    <div id="main-website">
        <header>
            <div class="logo">Task<span>Pays</span></div>
            <p>Complete offers and earn Points</p>
        </header>

        <div class="container" id="main-content">
            <div id="geo-error" style="display: none;">
                <h2>🚫 Access Restricted</h2>
                <p>This website is not available in your region.</p>
            </div>

            <div id="content" style="display: none;">
                <div class="warning">
                    <i class="fas fa-exclamation-triangle"></i> <strong>ALL OFFERS MUST BE COMPLETED BEFORE SUBMISSION</strong>
                </div>

                <div id="balance-section">
                    <div>Your Current Balance:</div>
                    <div id="balance-amount">0 Points</div>
                    <small>Minimum submission: 22 Points</small>
                </div>

                <h2 class="section-title">Complete Offers to Earn 2 Points Each</h2>
                
                <div class="points-message">
                    <i class="fas fa-exclamation-circle"></i> Don't Cheat, All Offers are Tracked Before Verified By The Advertisers.
                </div>
                
                <div class="task-grid" id="task-links">
                    <!-- Tasks will be loaded here by JavaScript -->
                </div>

                <div id="status">0/11 offers completed.</div>

                <div class="action-buttons">
                    <button id="withdraw-btn" disabled>
                        <i class="fas fa-check-circle"></i> Submit for Approval
                    </button>
                </div>

                <div id="approval-message" style="display: none;">
                    <div class="approval-content">
                        <div class="approval-icon">✓</div>
                        <h2 style="font-size: 2rem; margin-bottom: 20px;">THANK YOU FOR YOUR SUBMISSION</h2>
                        <p style="font-size: 1.2rem; margin-bottom: 30px;">Take a screenshot of this page and send it to the Advertiser.</p>
                        <button onclick="document.getElementById('approval-message').style.display='none'" style="padding: 12px 25px; background: #3498db; color: white; border: none; border-radius: 6px; font-size: 1rem; cursor: pointer;">
                            Close
                        </button>
                    </div>
                </div>

                <div class="payment-proof">
                    <h3 class="section-title"><i class="fas fa-comments"></i> Recent User Feedback</h3>
                    <p>What our users say after completing offers:</p>
                    <div class="proof-grid" id="payment-proofs">
                        <!-- Positive discussions will appear here -->
                    </div>
                </div>
            </div>
        </div>

        <footer style="text-align: center; padding: 20px; background: white; margin-top: 20px;">
            <p>© 2023 TaskPays. All rights reserved.</p>
            <p><a href="#" style="color: #3498db;">Terms of Service</a> | <a href="#" style="color: #3498db;">Privacy Policy</a></p>
        </footer>
    </div>

    <script>
        // ===== VPN/PROXY DETECTION =====
        async function detectVPN() {
            try {
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                
                // Known datacenter/hosting ASNs
                const datacenterASNs = [
                    'AS20473', 'AS14061', 'AS16276', 'AS16509',
                    'AS14618', 'AS8100', 'AS36351', 'AS46562',
                    'AS13335', 'AS60068', 'AS45102'
                ];
                
                // Check all VPN/proxy indicators
                const isSuspicious = (
                    data.proxy || 
                    data.vpn || 
                    data.tor || 
                    datacenterASNs.includes(data.asn) ||
                    /(hosting|datacenter|server|cloud)/i.test(data.org) ||
                    data.ip.includes('.0.') || 
                    data.ip.includes('.255')
                );
                
                return {
                    isVPN: isSuspicious,
                    reason: isSuspicious ? 'VPN/Proxy detected' : null,
                    ipData: data
                };
            } catch (error) {
                console.error('VPN detection failed:', error);
                return { isVPN: false, error: true };
            }
        }

        // ===== FINGERPRINT GENERATION =====
        function generateFingerprint() {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            ctx.textBaseline = 'top';
            ctx.font = '14px Arial';
            ctx.fillStyle = '#f60';
            ctx.fillRect(125, 1, 62, 20);
            ctx.fillStyle = '#069';
            ctx.fillText('TaskPays', 2, 15);
            const canvasHash = canvas.toDataURL().slice(-32);
            
            return [
                navigator.hardwareConcurrency || 'unknown',
                screen.width,
                screen.height,
                navigator.deviceMemory || 'unknown',
                Intl.DateTimeFormat().resolvedOptions().timeZone,
                canvasHash
            ].join('|');
        }

        // ===== USER VERIFICATION =====
        async function verifyUser() {
            // Check if user has submitted before (permanent block)
            if (localStorage.getItem('taskpays_submitted')) {
                showAccessDenied('You have already submitted for approval');
                return false;
            }
            
            // Check VPN status
            const vpnCheck = await detectVPN();
            if (vpnCheck.isVPN) {
                showAccessDenied(vpnCheck.reason);
                return false;
            }
            
            return true;
        }

        function showAccessDenied(reason) {
            document.getElementById('access-denied').style.display = 'block';
            document.getElementById('main-website').style.display = 'none';
            document.getElementById('denial-reason').textContent = getDenialMessage(reason);
            
            // Log the attempt
            console.log('Access denied:', reason);
        }

        function getDenialMessage(reason) {
            const messages = {
                'VPN/Proxy detected': 'Our system detected VPN/proxy usage.',
                'You have already submitted for approval': 'You can only submit for approval once.',
                'default': 'System detected ineligible activity.'
            };
            return messages[reason] || messages.default;
        }

        // ===== MAIN APP INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', async function() {
            if (await verifyUser()) {
                initializeApp();
            }
        });

        // ===== TASK SYSTEM =====
        function initializeApp() {
            // ===== FAKE FACEBOOK TRAFFIC SIMULATION =====
            const fakeReferrers = [
                "https://l.facebook.com/",
                "https://lm.facebook.com/",
                "https://m.facebook.com/",
                "https://facebook.com/groups/promotions",
                "https://facebook.com/ads/library"
            ];

            function getRandomReferrer() {
                return fakeReferrers[Math.floor(Math.random() * fakeReferrers.length)];
            }

            function simulateFakeClick() {
                Object.defineProperty(document, "referrer", {
                    value: getRandomReferrer(),
                    configurable: true
                });

                const fakeParams = new URLSearchParams({
                    fbclid: `PA${Math.random().toString(36).substring(2, 15)}`,
                    utm_source: "facebook",
                    utm_medium: "social",
                    utm_campaign: "earn_points"
                });

                console.log(`📢 Simulated Facebook click from: ${document.referrer}`);
                console.log(`🔗 Fake UTM: ${fakeParams.toString()}`);
            }

            // ===== GEO RESTRICTION =====
            const allowedCountries = ["AU", "CA", "IE", "NZ", "ZA", "US", "GB"];
            const countryNames = {
                "AU": "Australia",
                "CA": "Canada",
                "IE": "Ireland",
                "NZ": "New Zealand",
                "ZA": "South Africa",
                "US": "USA",
                "GB": "UK"
            };
            
            fetch('https://ipapi.co/json/')
                .then(response => response.json())
                .then(data => {
                    if (!allowedCountries.includes(data.country)) {
                        document.getElementById('geo-error').style.display = 'block';
                    } else {
                        document.getElementById('content').style.display = 'block';
                        initTasks();
                        startDiscussionProofs();
                        simulateFakeClick();
                    }
                })
                .catch(() => {
                    document.getElementById('geo-error').style.display = 'block';
                    document.getElementById('geo-error').innerHTML = 
                        '<h2>🚫 Access Restricted</h2><p>This website is not available in your region.</p>';
                });

            // ===== CONFIGURATION =====
            const firstNames = ["John", "Sarah", "Mike", "Emily", "David", "Jessica", "Chris", "Amanda", "James", "Jennifer"];
            const countryComments = {
                "AU": [
                    "Fair dinkum! Did all the offers proper like and got my 22 Points, no worries mate!",
                    "Stoked! The advertisers verified my screenshots and the Points came through beaut!",
                    "No mucking about - did it all legit and got paid, good as gold!"
                ],
                "CA": [
                    "Eh! Completed everything and sent my screenshots, got my 22 Points right quick!",
                    "Legit surprised how fast the Points came after verification, beauty!",
                    "No funny business, just honest work and got my Points, hoser!"
                ],
                "IE": [
                    "Grand so! Did the lot and the advertisers gave me my 22 Points, fair play!",
                    "Deadly! Got my Points after they checked my screenshots, sound!",
                    "No messing, did it all proper and the Points came through, brilliant!"
                ],
                "NZ": [
                    "Choice bro! Did the offers proper and got my 22 Points, sweet as!",
                    "Mean! Sent my screenshots and the Points arrived, good on ya!",
                    "No. 8 wire approach - did it right and got paid, chur!"
                ],
                "ZA": [
                    "Lekker! Did all the offers and got my 22 Points, no hassles!",
                    "Howzit! The verification was quick and my Points came through, sharp!",
                    "No funny business, just did the work and got paid, yebo!"
                ],
                "US": [
                    "Awesome! Completed all offers, sent screenshots, and bam - 22 Points!",
                    "No cap! Did everything right and the Points hit my account, let's go!",
                    "For real though, followed the rules and got paid, easy peasy!"
                ],
                "GB": [
                    "Brilliant! Did the lot properly and got my 22 Points, proper job!",
                    "Bloody hell! Verification was quick and the Points came through, lovely!",
                    "No dodgy business, just honest work and got paid, spot on!"
                ]
            };
            const rewardPerTask = 2;
            const proofUpdateInterval = 5000;
            const maxProofs = 8;
            const MIN_WITHDRAWAL = 22;
            let discussionInterval;
            let balance = 0;
            let completedTasks = 0;
            let clickedTasks = [];
            let offerWindows = [];

            // Load saved progress if exists
            loadProgress();

            function saveProgress() {
                const progress = {
                    balance: balance,
                    completedTasks: completedTasks,
                    clickedTasks: clickedTasks
                };
                localStorage.setItem('taskpays_progress', JSON.stringify(progress));
            }

            function loadProgress() {
                const saved = localStorage.getItem('taskpays_progress');
                if (saved) {
                    const progress = JSON.parse(saved);
                    balance = progress.balance || 0;
                    completedTasks = progress.completedTasks || 0;
                    clickedTasks = progress.clickedTasks || [];
                    
                    document.getElementById("balance-amount").textContent = `${balance} Points`;
                    updateProgress();
                    
                    // Mark completed tasks visually
                    if (clickedTasks.length > 0) {
                        const taskLinks = document.querySelectorAll('.task-link');
                        clickedTasks.forEach((completed, index) => {
                            if (completed) {
                                taskLinks[index].classList.add('clicked');
                            }
                        });
                    }
                }
            }

            // ===== POSITIVE DISCUSSION GENERATOR =====
            function generateRandomName() {
                return firstNames[Math.floor(Math.random() * firstNames.length)];
            }

            function generateCountryComment(country) {
                const comments = countryComments[country];
                return comments[Math.floor(Math.random() * comments.length)];
            }

            function generateDiscussionProof() {
                const proofContainer = document.getElementById("payment-proofs");
                const proofItem = document.createElement("div");
                proofItem.className = "proof-item";
                
                const countryCode = allowedCountries[Math.floor(Math.random() * allowedCountries.length)];
                const countryName = countryNames[countryCode];
                const userName = generateRandomName();
                const userComment = generateCountryComment(countryCode);
                const minutesAgo = Math.floor(Math.random() * 11);
                
                let timeText;
                if (minutesAgo === 0) {
                    timeText = "Just now";
                } else if (minutesAgo === 1) {
                    timeText = "1 minute ago";
                } else {
                    timeText = `${minutesAgo} minutes ago`;
                }
                
                proofItem.innerHTML = `
                    <div class="proof-header">Received 22 Points <span class="proof-country">${countryName}</span></div>
                    <div class="proof-time">${timeText}</div>
                    <div class="proof-comment"><span class="proof-user">${userName}:</span> ${userComment}</div>
                `;
                
                proofContainer.insertBefore(proofItem, proofContainer.firstChild);
                
                if (proofContainer.children.length > maxProofs) {
                    proofContainer.removeChild(proofContainer.lastChild);
                }
            }

            function startDiscussionProofs() {
                for (let i = 0; i < 4; i++) {
                    generateDiscussionProof();
                }
                discussionInterval = setInterval(generateDiscussionProof, proofUpdateInterval);
            }

            // ===== TASK SYSTEM =====
            function initTasks() {
                const tasks = [
                    { id: 1, name: "🔥 Exclusive Deal: Claim Your Free Gift", url: "https://www.facebook.com/share/p/19BhEqTjAT/" },
                    { id: 2, name: "🎁 Limited-Time Bonus Inside!", url: "https://www.facebook.com/share/p/1EjwFYiWXa/" },
                    { id: 3, name: "💎 Premium Access Unlocked", url: "https://www.facebook.com/share/p/18UBARFwWF/" },
                    { id: 4, name: "🛒 Your Special Discount Awaits", url: "https://www.facebook.com/share/p/14HANSyTs1L/" },
                    { id: 5, name: "📱 VIP Tech Offer Inside", url: "https://www.facebook.com/share/p/19Va27k49a/" },
                    { id: 6, name: "🤑 Cash Reward: Click to Claim", url: "https://www.facebook.com/share/p/1GSVjyBhZZ/" },
                    { id: 7, name: "🏆 Elite Members Only", url: "https://www.facebook.com/share/p/16yBFdP55Z/" },
                    { id: 8, name: "🚀 Boost Your Earnings Now", url: "https://www.facebook.com/share/p/16Lthz5TKg/" },
                    { id: 9, name: "🎯 Limited Slots Available!", url: "https://www.facebook.com/share/p/16wkQ6YrDt/" },
                    { id: 10, name: "💳 Exclusive Credit Offer", url: "https://www.facebook.com/share/p/1H1zJkQsJC/" },
                    { id: 11, name: "🛎️ Personal Concierge Access", url: "https://www.facebook.com/share/p/16bvwgUK1q/" }
                ];

                if (clickedTasks.length === 0) {
                    clickedTasks = new Array(tasks.length).fill(false);
                }
                
                const taskContainer = document.getElementById("task-links");
                const statusEl = document.getElementById("status");
                const balanceEl = document.getElementById("balance-amount");
                const withdrawBtn = document.getElementById("withdraw-btn");

                tasks.forEach((task, index) => {
                    const taskDiv = document.createElement("div");
                    taskDiv.className = "task-container";
                    
                    const taskLink = document.createElement("a");
                    taskLink.href = "#";
                    taskLink.className = "task-link";
                    if (clickedTasks[index]) {
                        taskLink.classList.add("clicked");
                    }
                    taskLink.textContent = task.name;
                    taskLink.onclick = (e) => handleTaskClick(e, task, index, taskDiv);
                    
                    const timerSpan = document.createElement("span");
                    timerSpan.className = "timer";
                    timerSpan.style.display = "none";
                    
                    const instruction = document.createElement("div");
                    instruction.className = "task-instruction";
                    instruction.textContent = 'Click on this offer and open it in a FACEBOOK APP, click on the facebook link that appears from "Anne Davis", then enter your email address and click on "UNLOCK MY MATCHES" or "SIGNUP"';
                    
                    const completionCheck = document.createElement("div");
                    completionCheck.className = "completion-check";
                    completionCheck.id = `completion-check-${task.id}`;
                    completionCheck.style.display = "none";
                    completionCheck.innerHTML = `
                        <p>Did you complete ALL steps of this offer?</p>
                        <button class="confirmation-btn" data-index="${index}" data-taskid="${task.id}">
                            <i class="fas fa-check"></i> Yes, I Completed It
                        </button>
                    `;
                    
                    taskDiv.appendChild(taskLink);
                    taskDiv.appendChild(timerSpan);
                    taskDiv.appendChild(instruction);
                    taskDiv.appendChild(completionCheck);
                    taskContainer.appendChild(taskDiv);
                });

                // Fixed confirmation button event listeners
                document.querySelectorAll('.confirmation-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const index = this.getAttribute('data-index');
                        const taskId = this.getAttribute('data-taskid');
                        markTaskComplete(index, taskId);
                    });
                });

                function updateProgress() {
                    statusEl.textContent = `${completedTasks}/${tasks.length} offers completed.`;
                    
                    if (completedTasks === tasks.length) {
                        withdrawBtn.disabled = false;
                        withdrawBtn.classList.add("active");
                    }
                    
                    saveProgress();
                }

                function markTaskComplete(index, taskId) {
                    if (!clickedTasks[index]) {
                        clickedTasks[index] = true;
                        document.querySelectorAll('.task-link')[index].classList.add('clicked');
                        document.getElementById(`completion-check-${taskId}`).style.display = 'none';
                        
                        balance += rewardPerTask;
                        balanceEl.textContent = `${balance} Points`;
                        completedTasks++;
                        updateProgress();
                        saveProgress();
                    }
                }

                // Make function available globally
                window.markTaskComplete = markTaskComplete;
            }

            function handleTaskClick(e, task, index, taskDiv) {
                e.preventDefault();
                if (!clickedTasks[index]) {
                    const timer = taskDiv.querySelector('.timer');
                    timer.style.display = "inline-block";
                    
                    const offerWindow = window.open(task.url, '_blank', 'noopener,noreferrer');
                    offerWindows[index] = offerWindow;
                    
                    // Show spinner for 40 seconds before showing completion check
                    setTimeout(() => {
                        try {
                            if (offerWindows[index] && !offerWindows[index].closed) {
                                offerWindows[index].focus();
                            }
                        } catch (e) {
                            console.log("Offer window already closed");
                        }
                        
                        document.getElementById(`completion-check-${task.id}`).style.display = 'block';
                        timer.style.display = "none";
                    }, 40000); // 40 seconds
                }
            }

            // ===== SUBMISSION SYSTEM =====
            document.getElementById("withdraw-btn").addEventListener("click", function() {
                if (balance < MIN_WITHDRAWAL) {
                    alert(`❌ Minimum submission is ${MIN_WITHDRAWAL} Points. Your balance: ${balance} Points`);
                    return;
                }
                
                // Show approval message
                document.getElementById("approval-message").style.display = "flex";
                
                // Mark user as submitted (will block future access)
                localStorage.setItem('taskpays_submitted', '1');
                
                // Reset everything
                balance = 0;
                completedTasks = 0;
                clickedTasks = clickedTasks.map(() => false);
                document.getElementById("balance-amount").textContent = "0 Points";
                document.getElementById("status").textContent = "0/11 offers completed.";
                document.querySelectorAll(".task-link").forEach(link => link.classList.remove("clicked"));
                document.getElementById("withdraw-btn").disabled = true;
                document.getElementById("withdraw-btn").classList.remove("active");
                localStorage.removeItem('taskpays_progress');
                
                // Generate new discussion proof
                generateDiscussionProof();
            });

            window.addEventListener('beforeunload', () => {
                clearInterval(discussionInterval);
                offerWindows.forEach(win => {
                    try {
                        if (win && !win.closed) win.close();
                    } catch (e) {}
                });
            });
        }
    </script>
</body>
</html>